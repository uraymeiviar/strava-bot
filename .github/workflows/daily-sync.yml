name: Targeted Strava Sync

on:
  schedule:
    # Target hours (UTC): 00:00, 02:00, 04:00, 06:00, 08:00, 10:00, 12:00, 19:00
    # This maps to 07, 09, 11, 13, 15, 17, 19, 02 in GMT+7
    - cron: '0 0,2,4,6,8,10,12,19 * * *'
  workflow_dispatch: # Still allows you to run it manually

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Dependencies
        run: npm install axios google-spreadsheet google-auth-library

      - name: Run Sync Script
        run: node sync.js
        env:
          STRAVA_CLIENT_ID: ${{ secrets.STRAVA_CLIENT_ID }}
          STRAVA_CLIENT_SECRET: ${{ secrets.STRAVA_CLIENT_SECRET }}
          GOOGLE_SERVICE_ACCOUNT_EMAIL: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_EMAIL }}
          GOOGLE_PRIVATE_KEY: ${{ secrets.GOOGLE_PRIVATE_KEY }}
          SHEET_ID: ${{ secrets.SHEET_ID }}